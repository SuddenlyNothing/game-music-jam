[gd_scene load_steps=29 format=2]

[ext_resource path="res://assets/environment/room/room_background.png" type="Texture" id=1]
[ext_resource path="res://assets/environment/room/trash_can.png" type="Texture" id=2]
[ext_resource path="res://assets/environment/room/weights.png" type="Texture" id=3]
[ext_resource path="res://utils/SpriteSelect.tscn" type="PackedScene" id=4]
[ext_resource path="res://assets/environment/room/bed.png" type="Texture" id=5]
[ext_resource path="res://assets/environment/room/desk.png" type="Texture" id=6]
[ext_resource path="res://assets/environment/room/door.png" type="Texture" id=7]
[ext_resource path="res://assets/environment/outside/fall/background.png" type="Texture" id=8]
[ext_resource path="res://assets/environment/outside/fall/foreground.png" type="Texture" id=9]
[ext_resource path="res://assets/environment/outside/summer/background.png" type="Texture" id=10]
[ext_resource path="res://assets/environment/outside/summer/foreground.png" type="Texture" id=11]
[ext_resource path="res://assets/environment/outside/spring/background.png" type="Texture" id=12]
[ext_resource path="res://assets/environment/outside/spring/foreground.png" type="Texture" id=13]
[ext_resource path="res://assets/environment/outside/winter/background.png" type="Texture" id=14]
[ext_resource path="res://assets/environment/outside/winter/foreground.png" type="Texture" id=15]
[ext_resource path="res://assets/particles/leaves.png" type="Texture" id=16]
[ext_resource path="res://assets/particles/snow.png" type="Texture" id=17]
[ext_resource path="res://scenes/environment/Room.gd" type="Script" id=18]
[ext_resource path="res://assets/environment/room/light_under.png" type="Texture" id=19]
[ext_resource path="res://assets/environment/room/lights_over.png" type="Texture" id=20]

[sub_resource type="CanvasItemMaterial" id=1]
particles_animation = true
particles_anim_h_frames = 5
particles_anim_v_frames = 1
particles_anim_loop = false

[sub_resource type="Curve" id=2]
_data = [ Vector2( 0, 0 ), 0.0, 0.0, 0, 0, Vector2( 0.197044, 1 ), 0.0, 0.0, 0, 0, Vector2( 0.70936, 1 ), 0.0, 0.0, 0, 0, Vector2( 1, 0 ), -3.28114, 0.0, 0, 0 ]

[sub_resource type="CanvasItemMaterial" id=3]
particles_animation = true
particles_anim_h_frames = 4
particles_anim_v_frames = 1
particles_anim_loop = false

[sub_resource type="Curve" id=4]
_data = [ Vector2( 0, 0 ), 0.0, 0.0, 0, 0, Vector2( 0.118227, 1 ), 0.0, 0.0, 0, 0, Vector2( 0.79803, 1 ), 0.0, 0.0, 0, 0, Vector2( 1, 0 ), 0.0, 0.0, 0, 0 ]

[sub_resource type="Shader" id=6]
code = "shader_type canvas_item;
render_mode unshaded;

uniform float line_scale : hint_range(0, 4) = 1.0;

//If not using a texture, will blend between these two colors
uniform vec4 outline_color : hint_color;

varying vec2 o;
varying vec2 f;

void vertex()
{
	//Expands the vertexes so we have space to draw the outline if we were on the edge.
	o = VERTEX;
	vec2 uv = (UV - 0.5);
	VERTEX += uv * line_scale * TEXTURE_PIXEL_SIZE * 100.0;
	f = VERTEX;
}

void fragment()
{
	ivec2 t = textureSize(TEXTURE, 0);
	vec2 regular_uv;
	regular_uv.x = UV.x + (f.x - o.x)/float(t.x);
	regular_uv.y = UV.y + (f.y - o.y)/float(t.y);
	
	vec4 regular_color = texture(TEXTURE, regular_uv);
	
	if((regular_uv.x < 0.0 || regular_uv.x > 1.0) || (regular_uv.y < 0.0 || regular_uv.y > 1.0) || regular_color.a <=0.25){
		regular_color = vec4(0.0); 
	}
	
	vec2 ps = TEXTURE_PIXEL_SIZE * line_scale;
	
	vec4 final_color = regular_color;
	if (regular_color.a <= 0.0)
	{
		
		vec2 outline_uv = regular_uv + vec2(1.0 * ps.x, 0.0 * ps.y); 
		vec4 outline_sample = texture(TEXTURE, outline_uv);
		if((outline_uv.x < 0.0 || outline_uv.x > 1.0) || (outline_uv.y < 0.0 || outline_uv.y > 1.0)){
			outline_sample = vec4(0);
		}
		if(outline_sample.a > final_color.a){
			final_color = outline_color;
		}
		
		outline_uv = regular_uv + vec2(-1.0 * ps.x, 0.0 * ps.y); 
		outline_sample = texture(TEXTURE, outline_uv);
		if((outline_uv.x < 0.0 || outline_uv.x > 1.0) || (outline_uv.y < 0.0 || outline_uv.y > 1.0)){
			outline_sample = vec4(0);
		}
		if(outline_sample.a > final_color.a){
			final_color = outline_color;
		}
		
		outline_uv = regular_uv + vec2(0.0 * ps.x, -1.0 * ps.y); 
		outline_sample = texture(TEXTURE, outline_uv);
		if((outline_uv.x < 0.0 || outline_uv.x > 1.0) || (outline_uv.y < 0.0 || outline_uv.y > 1.0)){
			outline_sample = vec4(0);
		}
		if(outline_sample.a > final_color.a){
			final_color = outline_color;
		}
		
		outline_uv = regular_uv + vec2(0.0 * ps.x, 1.0 * ps.y); 
		outline_sample = texture(TEXTURE, outline_uv);
		if((outline_uv.x < 0.0 || outline_uv.x > 1.0) || (outline_uv.y < 0.0 || outline_uv.y > 1.0)){
			outline_sample = vec4(0);
		}
		if(outline_sample.a > final_color.a){
			final_color = outline_color;
		}
	}
	COLOR = final_color; 
}"

[sub_resource type="ShaderMaterial" id=7]
resource_local_to_scene = true
shader = SubResource( 6 )
shader_param/line_scale = 0.0
shader_param/outline_color = Color( 1, 1, 1, 1 )

[sub_resource type="ShaderMaterial" id=8]
resource_local_to_scene = true
shader = SubResource( 6 )
shader_param/line_scale = 0.0
shader_param/outline_color = Color( 1, 1, 1, 1 )

[sub_resource type="ShaderMaterial" id=9]
resource_local_to_scene = true
shader = SubResource( 6 )
shader_param/line_scale = 0.0
shader_param/outline_color = Color( 1, 1, 1, 1 )

[node name="Room" type="Node2D"]
script = ExtResource( 18 )

[node name="ParallaxBackground" type="ParallaxBackground" parent="."]

[node name="ParallaxLayer" type="ParallaxLayer" parent="ParallaxBackground"]
motion_mirroring = Vector2( 448, 256 )

[node name="ColorRect" type="ColorRect" parent="ParallaxBackground/ParallaxLayer"]
margin_right = 448.0
margin_bottom = 256.0
mouse_filter = 2
color = Color( 0, 0, 0, 1 )

[node name="Outside" type="Node2D" parent="."]
position = Vector2( 192, 128 )
z_index = -100

[node name="Summer" type="Node2D" parent="Outside"]

[node name="Background" type="Sprite" parent="Outside/Summer"]
texture = ExtResource( 10 )

[node name="Foreground" type="Sprite" parent="Outside/Summer"]
z_index = 70
texture = ExtResource( 11 )

[node name="Fall" type="Node2D" parent="Outside"]
visible = false

[node name="Background" type="Sprite" parent="Outside/Fall"]
texture = ExtResource( 8 )

[node name="Leaves" type="CPUParticles2D" parent="Outside/Fall/Background"]
material = SubResource( 1 )
position = Vector2( 0, -64 )
amount = 16
lifetime = 5.0
preprocess = 10.0
texture = ExtResource( 16 )
emission_shape = 2
emission_rect_extents = Vector2( 192, 128 )
spread = 180.0
gravity = Vector2( 0, 10 )
initial_velocity = 20.0
initial_velocity_random = 1.0
angular_velocity = 100.0
angular_velocity_random = 1.0
scale_amount_curve = SubResource( 2 )
anim_offset = 1.0
anim_offset_random = 1.0

[node name="Foreground" type="Sprite" parent="Outside/Fall"]
z_index = 70
texture = ExtResource( 9 )

[node name="Leaves" type="CPUParticles2D" parent="Outside/Fall/Foreground"]
material = SubResource( 1 )
position = Vector2( 0, -64 )
z_index = -70
amount = 16
lifetime = 5.0
preprocess = 10.0
texture = ExtResource( 16 )
emission_shape = 2
emission_rect_extents = Vector2( 192, 128 )
spread = 180.0
gravity = Vector2( 0, 10 )
initial_velocity = 20.0
initial_velocity_random = 1.0
angular_velocity = 100.0
angular_velocity_random = 1.0
scale_amount_curve = SubResource( 2 )
anim_offset = 1.0
anim_offset_random = 1.0

[node name="Winter" type="Node2D" parent="Outside"]
visible = false

[node name="Background" type="Sprite" parent="Outside/Winter"]
texture = ExtResource( 14 )

[node name="Snow" type="CPUParticles2D" parent="Outside/Winter/Background"]
material = SubResource( 3 )
position = Vector2( 0, -64 )
amount = 20
lifetime = 8.0
preprocess = 30.0
texture = ExtResource( 17 )
emission_shape = 2
emission_rect_extents = Vector2( 192, 128 )
direction = Vector2( 0, 1 )
spread = 90.0
gravity = Vector2( 0, 5 )
initial_velocity = 10.0
initial_velocity_random = 1.0
scale_amount_curve = SubResource( 4 )
anim_offset = 1.0
anim_offset_random = 1.0

[node name="Foreground" type="Sprite" parent="Outside/Winter"]
z_index = 70
texture = ExtResource( 15 )

[node name="Snow" type="CPUParticles2D" parent="Outside/Winter/Foreground"]
material = SubResource( 3 )
position = Vector2( 0, -64 )
z_index = -70
amount = 20
lifetime = 8.0
preprocess = 30.0
texture = ExtResource( 17 )
emission_shape = 2
emission_rect_extents = Vector2( 192, 128 )
direction = Vector2( 0, 1 )
spread = 90.0
gravity = Vector2( 0, 5 )
initial_velocity = 10.0
initial_velocity_random = 1.0
scale_amount_curve = SubResource( 4 )
anim_offset = 1.0
anim_offset_random = 1.0

[node name="Spring" type="Node2D" parent="Outside"]
visible = false

[node name="Background" type="Sprite" parent="Outside/Spring"]
texture = ExtResource( 12 )

[node name="Foreground" type="Sprite" parent="Outside/Spring"]
z_index = 70
texture = ExtResource( 13 )

[node name="YSort" type="YSort" parent="."]
z_index = 100

[node name="RoomElements" type="YSort" parent="YSort"]
position = Vector2( 326, 200.5 )

[node name="RoomBackground" type="Sprite" parent="YSort/RoomElements"]
texture = ExtResource( 1 )

[node name="TrashCan" type="Sprite" parent="YSort/RoomElements"]
texture = ExtResource( 2 )

[node name="Weights" parent="YSort/RoomElements" instance=ExtResource( 4 )]
material = SubResource( 7 )

[node name="Weights" type="Sprite" parent="YSort/RoomElements/Weights"]
use_parent_material = true
texture = ExtResource( 3 )

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="YSort/RoomElements/Weights"]
polygon = PoolVector2Array( -67, 63.5, -34, 80.5, -16, 62.5, -31, 55.5, -57, 55.5 )

[node name="Bed" parent="YSort/RoomElements" instance=ExtResource( 4 )]
material = SubResource( 8 )

[node name="Bed" type="Sprite" parent="YSort/RoomElements/Bed"]
use_parent_material = true
texture = ExtResource( 5 )

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="YSort/RoomElements/Bed"]
polygon = PoolVector2Array( -22, 89.5, 3, 102.5, 51, 77.5, 51, 62.5, 28, 46.5, 0, 58.5, -23, 76.5 )

[node name="Desk" parent="YSort/RoomElements" instance=ExtResource( 4 )]
material = SubResource( 9 )

[node name="Desk" type="Sprite" parent="YSort/RoomElements/Desk"]
use_parent_material = true
texture = ExtResource( 6 )

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="YSort/RoomElements/Desk"]
polygon = PoolVector2Array( -34, 19.5, 10, 42.5, 33, 24.5, 32, -16.5, 2, -40.5, -34, -20.5 )

[node name="Door" type="Sprite" parent="YSort/RoomElements"]
texture = ExtResource( 7 )

[node name="LightUnder" type="Sprite" parent="YSort/RoomElements"]
texture = ExtResource( 19 )

[node name="LightsOver" type="Sprite" parent="YSort/RoomElements"]
position = Vector2( 0, 45 )
z_index = 20
texture = ExtResource( 20 )
offset = Vector2( 0, -45 )
